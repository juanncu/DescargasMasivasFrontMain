<main class="main-container">
  <div class="main-title">DESCARGA MASIVA DE FOLIOS</div>

  <section class="filter-card">
    <div class="filter-header">
      <div class="header-icon-title">
        <span class="material-icons">filter_alt</span>
        <h2>Filtros de Búsqueda</h2>
      </div>
      <p>Seleccione los criterios para generar la descarga</p>
    </div>

    <div class="filter-body">
      <div class="selection-grid">

        <div class="input-field">
          <div class="label-with-info">
            <label>Estado de Recibo</label>
            <div class="info-icon-wrapper" *ngIf="estadoSeleccionadoId">
              <mat-icon class="info-icon">info</mat-icon>
              <span class="tooltip-box">
                {{
                estadoSeleccionadoId === '1' ? 'Cobrado, Conciliado, Conciliado Parcial' :
                estadoSeleccionadoId === '2' ? 'Folios Cancelados' :
                estadoSeleccionadoId === '3' ? 'Cobrado, Cancelado, Conciliado, Conciliado Parcial' :
                'Seleccione un estado para ver la descripción'
                }}
              </span>
            </div>
          </div>
          <select [(ngModel)]="estadoSeleccionadoId" class="modern-select">
            <option [ngValue]="null">Seleccione estado</option>
            <option *ngFor="let e of estados" [ngValue]="e.id">{{ e.nombre }}</option>
          </select>
        </div>

        <div class="input-field">
          <div class="label-with-info">
            <label>Padrón</label>
            <div class="info-icon-wrapper" *ngIf="padronSeleccionadoId === '1'">
              <mat-icon class="info-icon">info</mat-icon>
              <span class="tooltip-box">Contrato Vehicular, Obligaciones, Crédito, Infracciones, Alcohol</span>
            </div>
          </div>
          <select [(ngModel)]="padronSeleccionadoId" class="modern-select">
            <option [ngValue]="null">Seleccione padrón</option>
            <option *ngFor="let p of padrones" [ngValue]="p.id">{{ p.nombre }}</option>
          </select>
        </div>

        <div class="input-field">
          <label>Formato</label>
          <div class="format-options">
            <label class="check-item"><input type="checkbox" [(ngModel)]="formatoPdf"> PDF</label>
            <label class="check-item"><input type="checkbox" [(ngModel)]="formatoXml"> XML</label>
            <label class="check-item"><input type="checkbox" [(ngModel)]="formatoRecibos"> Recibos</label>
          </div>
        </div>
      </div>
      <div class="date-grid">
                <div class="input-field">
          <label>Año</label>
          <select [(ngModel)]="anio" class="modern-select">
            <option *ngFor="let a of aniosDisponibles" [value]="a">{{ a }}</option>
          </select>
        </div>
        
        <div class="input-field">
          <label>Mes Inicio</label>
          <select [(ngModel)]="mesInicio" class="modern-select">
            <option *ngFor="let m of meses" [value]="m.id">{{ m.nombre }}</option>
          </select>
        </div>
        <div class="input-field">
          <label>Mes Final</label>
          <select [(ngModel)]="mesFinal" class="modern-select">
            <option *ngFor="let m of meses" [value]="m.id">{{ m.nombre }}</option>
          </select>
        </div>

      </div>

      <div class="input-field full-width">
        <label>Delegación</label>
        <select [(ngModel)]="delegacionSeleccionada" class="modern-select">
  <option [ngValue]="null" disabled>Seleccione una delegación</option>
  <option *ngFor="let d of listaDelegaciones" [ngValue]="d.delegacionID">
    {{ d.delegacion }}
  </option>
</select>
      </div>

      <div class="action-footer">
  <button class="btn-preview" [disabled]="true" style="opacity: 0.5; cursor: not-allowed;">
    <mat-icon>visibility</mat-icon> VISTA PREVIA
  </button>

  <button 
    class="btn-buscar-modern" 
    (click)="buscar()" 
    [disabled]="!delegacionSeleccionada || !mesInicio || !mesFinal || cargando">
    <mat-icon *ngIf="!cargando">search</mat-icon>
    <mat-spinner *ngIf="cargando" diameter="20"></mat-spinner>
    {{ cargando ? 'BUSCANDO...' : 'BUSCAR DOCUMENTOS' }}
  </button>
</div>

    </div>
  </section>

  <div *ngIf="mostrarModalResultados" class="modal-overlay">
    <div class="modal-content animate-zoom animate-bounce-in results-modal-custom">
      <div class="modal-header-red">
        <span class="material-icons">analytics</span>
        <h2>Resumen de Búsqueda</h2>
        <button class="close-x" (click)="cerrarModalResultados()">×</button>
      </div>

      <div class="modal-body-padding">
        <p class="instruction-text">Se han localizado los siguientes documentos según sus filtros:</p>
        <div class="modal-stats-grid">
          <div class="stat-card-mini">
            <span class="stat-label">Archivos encontrados</span>
            <span class="stat-value-red">{{ resultados?.archivos }}</span>
          </div>
          <div class="stat-card-mini">
            <span class="stat-label">Tamaño aproximado</span>
            <span class="stat-value-red">{{ resultados?.tamanio }}</span>
          </div>
        </div>
        <div class="modal-info-footer">
          <span class="material-icons">timer</span>
          <span>Tiempo estimado de procesamiento: <strong>5 minutos</strong></span>
        </div>
      </div>

      <div class="modal-actions-column">
        <button (click)="confirmarDescarga()" class="btn-buscar-modern">
          <span class="material-icons">cloud_download</span> CONFIRMAR DESCARGA
        </button>
        <button (click)="cerrarModalResultados()" class="btn-link-cancel">
          Regresar a filtros
        </button>
      </div>
    </div>
  </div>
</main>